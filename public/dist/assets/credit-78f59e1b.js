import{r as a,j as t,C as oe,S as A,T as W,B as i,I as ue,a as he,b as d,c as me,d as xe,e as ge,f as je,g as k,h as s,i as I,k as pe,l as Ce,m as ye,D as U,n as N,o as _,A as M,p as R,q as m,W as fe}from"./index-39b37d24.js";const ve=({inputData:o,filterName:x})=>o==null?void 0:o.filter(c=>{var p;return(p=c==null?void 0:c.summery)==null?void 0:p.toLowerCase().includes(x==null?void 0:x.toLowerCase())});function Se(){const[o,x]=a.useState(0),[c,p]=a.useState("asc"),[l,z]=a.useState("date"),[T,q]=a.useState(""),[C,H]=a.useState(5),[G,$]=a.useState([]),[J,F]=a.useState(!0),[Q,y]=a.useState(!1),[V,g]=a.useState(!1),[X,Y]=a.useState([]),[u,f]=a.useState(null),[Z,w]=a.useState([]),[ee,D]=a.useState([]),[j,v]=a.useState(""),[S,b]=a.useState(""),[L,te]=a.useState(""),h=()=>localStorage.getItem("authKey"),[E,ae]=a.useState(null),se=e=>{ae(e==null?void 0:e._id),f(e.userId)};a.useEffect(()=>{(async()=>{try{const n=await m.get("http://65.1.233.188:9000/api/v1/admin/transaction/get-all-credit",{headers:{authKey:`${h()}`}});$(n.data.data),F(!1)}catch(n){console.error("Error fetching data:",n),F(!1)}})()},[]),a.useEffect(()=>{const e=async()=>{try{const r=await m.get("http://65.1.233.188:9000/api/v1/admin/user/get-all-customer",{headers:{authKey:`${h()}`}});Y(r.data.data)}catch(r){console.error("Error fetching users:",r)}},n=async()=>{try{const r=await m.get("http://65.1.233.188:9000/api/v1/admin/product/get-all-product",{headers:{authKey:`${h()}`}});w(r.data.data)}catch(r){console.error("Error fetching products:",r)}};e(),n()},[]);const P=e=>{p(l===e&&c==="asc"?"desc":"asc"),z(e)},ne=(e,n)=>{x(n)},re=e=>{x(0),H(parseInt(e.target.value,10))},ce=e=>{q(e.target.value)},le=async()=>{try{await m.post("http://65.1.233.188:9000/api/v1/admin/transaction/creat-credit",{summery:S,productDetails:ee.map(n=>n.productId),Toatalamount:j,amount:j,userId:u==null?void 0:u._id},{headers:{authKey:`${h()}`}});const e=await m.get("http://65.1.233.188:9000/api/v1/admin/transaction/get-all-credit",{headers:{authKey:`${h()}`}});$(e.data.data),g(!1),f(null),D([]),v(""),b("")}catch(e){console.error("Error creating credit:",e)}},ie=async()=>{try{await m.patch("http://65.1.233.188:9000/api/v1/admin/transaction/pay-credit",{transId:E,amount:j,summery:S,Toatalmount:L},{headers:{authKey:`${h()}`}});const e=await m.get("http://65.1.233.188:9000/api/v1/admin/transaction/get-all-credit",{headers:{authKey:`${h()}`}});$(e.data.data),y(!1),f(null),D([]),v(""),b("")}catch(e){console.error("Error paying credit:",e)}},K=ve({inputData:G,filterName:T}),de=!K.length&&!!T;return t.jsxs(oe,{children:[t.jsxs(A,{direction:"row",alignItems:"center",justifyContent:"space-between",mt:5,mb:5,children:[t.jsx(W,{variant:"h4",children:"Customer Credits"}),t.jsx(i,{variant:"contained",color:"inherit",startIcon:t.jsx(ue,{icon:"eva:plus-fill"}),onClick:()=>g(!0),children:"Add New Credit"})]}),t.jsxs(he,{children:[t.jsx(A,{direction:"row",alignItems:"center",justifyContent:"space-between",p:2,children:t.jsx(d,{variant:"outlined",value:T,onChange:ce,placeholder:"Search by summary"})}),t.jsx(me,{children:t.jsx(xe,{sx:{overflow:"unset",p:2},children:t.jsxs(ge,{sx:{minWidth:800},children:[t.jsx(je,{children:t.jsxs(k,{children:[t.jsx(s,{children:"Name"}),t.jsx(s,{children:"Phone"}),t.jsx(s,{children:t.jsx(I,{active:l==="productCount",direction:l==="productCount"?c:"asc",onClick:()=>P("productCount"),children:"Product Count"})}),t.jsx(s,{children:t.jsx(I,{active:l==="dueAmount",direction:l==="dueAmount"?c:"asc",onClick:()=>P("dueAmount"),children:"Due Amount"})}),t.jsx(s,{children:t.jsx(I,{active:l==="totalAmount",direction:l==="totalAmount"?c:"asc",onClick:()=>P("totalAmount"),children:"Total Amount"})}),t.jsx(s,{children:"Summary"}),t.jsx(s,{children:t.jsx(I,{active:l==="createdAt",direction:l==="createdAt"?c:"asc",onClick:()=>P("createdAt"),children:"Date"})}),t.jsx(s,{children:" "})]})}),t.jsxs(pe,{children:[J?t.jsx(k,{children:t.jsx(s,{colSpan:8,align:"center",children:"Loading..."})}):K.slice(o*C,o*C+C).map(e=>{var n,r,B,O;return t.jsxs(k,{children:[t.jsx(s,{children:`${(n=e==null?void 0:e.userId)==null?void 0:n.firstName} ${(r=e==null?void 0:e.userId)==null?void 0:r.surname}`}),t.jsx(s,{children:(B=e==null?void 0:e.userId)==null?void 0:B.phone}),t.jsx(s,{children:(O=e==null?void 0:e.productDetails)==null?void 0:O.length}),t.jsx(s,{children:e==null?void 0:e.dueAmount}),t.jsx(s,{children:e==null?void 0:e.Toatalmount}),t.jsx(s,{children:e==null?void 0:e.summery}),t.jsx(s,{children:new Date(e==null?void 0:e.updatedAt).toLocaleDateString()}),t.jsx(s,{children:t.jsx(Ce,{checked:E===e._id,onChange:()=>se(e)})})]},e._id)}),de&&t.jsx(k,{children:t.jsx(s,{colSpan:8,align:"center",children:"No data found"})})]})]})})}),t.jsxs(A,{direction:"row",spacing:2,justifyContent:"left",p:2,mt:2,children:[t.jsx(i,{variant:"contained",color:"success",size:"large",onClick:()=>g(!0),children:"Credit"}),t.jsx(i,{variant:"contained",color:"error",size:"large",onClick:()=>y(!0),disabled:!E,children:"Pay"}),t.jsx(i,{variant:"contained",color:"inherit",size:"large",onClick:()=>window.history.back(),children:"Back"})]}),t.jsx(ye,{rowsPerPageOptions:[5,10,25],component:"div",count:K.length,rowsPerPage:C,page:o,onPageChange:ne,onRowsPerPageChange:re})]}),t.jsxs(U,{open:V,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(N,{children:"Add Credit"}),t.jsx(_,{children:t.jsxs(A,{spacing:3,children:[t.jsx(M,{options:X,getOptionLabel:e=>`${e==null?void 0:e.firstName} ${e==null?void 0:e.surname}`,renderInput:e=>t.jsx(d,{...e,label:"Select User"}),onChange:(e,n)=>f(n)}),t.jsx(M,{multiple:!0,options:Z,getOptionLabel:e=>e==null?void 0:e.product_Name,renderInput:e=>t.jsx(d,{...e,label:"Select Products"}),onChange:(e,n)=>D(n.map(r=>({productId:r==null?void 0:r._id,quantity:1})))}),t.jsx(d,{label:"Amount",value:j,onChange:e=>v(e.target.value),fullWidth:!0}),t.jsx(d,{label:"Comment",value:S,onChange:e=>b(e.target.value),fullWidth:!0}),t.jsx(i,{variant:"contained",onClick:le,children:"Submit"})]})}),t.jsx(R,{children:t.jsx(i,{onClick:()=>g(!1),children:"Cancel"})})]}),t.jsxs(U,{open:Q,onClose:()=>y(!1),children:[t.jsx(N,{children:"Make a Payment"}),t.jsxs(_,{children:[t.jsx(d,{label:"Amount",type:"number",value:j,onChange:e=>v(e.target.value),fullWidth:!0,margin:"normal"}),t.jsx(d,{label:"Total Amount",type:"number",value:L,onChange:e=>te(e.target.value),fullWidth:!0,margin:"normal"}),t.jsx(d,{label:"Comment",value:S,onChange:e=>b(e.target.value),fullWidth:!0,margin:"normal"}),u&&t.jsxs(t.Fragment,{children:[t.jsxs(W,{variant:"subtitle1",children:["User: ",u.firstName," ",u.surname]}),t.jsxs(W,{variant:"subtitle1",children:["Phone: ",u.phone]})]})]}),t.jsxs(R,{children:[t.jsx(i,{onClick:()=>y(!1),children:"Cancel"}),t.jsx(i,{variant:"contained",onClick:ie,children:"Submit"})]})]})]})}function Pe(){return t.jsxs(t.Fragment,{children:[t.jsx(fe,{children:t.jsx("title",{children:" Customer Credit "})}),t.jsx(Se,{})]})}export{Pe as default};
