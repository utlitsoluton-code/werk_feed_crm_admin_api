import{u as ue,r as a,j as e,C as he,S as A,T as W,B as d,I as me,a as xe,b as o,c as ge,d as je,e as pe,f as Ce,g as k,h as s,i as I,k as ye,l as fe,m as ve,D as U,n as N,o as _,A as M,p as R,q as x,W as Se}from"./index-98bf78b2.js";const be=({inputData:c,filterName:u})=>c==null?void 0:c.filter(g=>{var i;return(i=g==null?void 0:g.summery)==null?void 0:i.toLowerCase().includes(u==null?void 0:u.toLowerCase())});function Pe(){const c=ue(t=>t);console.log({user:c},"usersssss");const[u,g]=a.useState(0),[i,z]=a.useState("asc"),[l,q]=a.useState("date"),[T,H]=a.useState(""),[C,G]=a.useState(5),[J,$]=a.useState([]),[Q,F]=a.useState(!0),[V,y]=a.useState(!1),[X,j]=a.useState(!1),[Y,Z]=a.useState([]),[h,f]=a.useState(null),[w,ee]=a.useState([]),[te,D]=a.useState([]),[p,v]=a.useState(""),[S,b]=a.useState(""),[L,ae]=a.useState(""),m=()=>localStorage.getItem("authKey"),[E,se]=a.useState(null),ne=()=>{se(c==null?void 0:c._id),f(c.userId)};a.useEffect(()=>{(async()=>{try{const n=await x.get("http://65.1.233.188:9000/api/v1/admin/transaction/get-all-credit",{headers:{authKey:`${m()}`}});$(n.data.data),F(!1)}catch(n){console.error("Error fetching data:",n),F(!1)}})()},[]),a.useEffect(()=>{const t=async()=>{try{const r=await x.get("http://65.1.233.188:9000/api/v1/admin/user/get-all-customer",{headers:{authKey:`${m()}`}});Z(r.data.data)}catch(r){console.error("Error fetching users:",r)}},n=async()=>{try{const r=await x.get("http://65.1.233.188:9000/api/v1/admin/product/get-all-product",{headers:{authKey:`${m()}`}});ee(r.data.data)}catch(r){console.error("Error fetching products:",r)}};t(),n()},[]);const P=t=>{z(l===t&&i==="asc"?"desc":"asc"),q(t)},re=(t,n)=>{g(n)},ce=t=>{g(0),G(parseInt(t.target.value,10))},le=t=>{H(t.target.value)},ie=async()=>{try{await x.post("http://65.1.233.188:9000/api/v1/admin/transaction/creat-credit",{summery:S,productDetails:te.map(n=>n.productId),Toatalmount:p,amount:p,userId:h==null?void 0:h._id},{headers:{authKey:`${m()}`}});const t=await x.get("http://65.1.233.188:9000/api/v1/admin/transaction/get-all-credit",{headers:{authKey:`${m()}`}});$(t.data.data),j(!1),f(null),D([]),v(""),b("")}catch(t){console.error("Error creating credit:",t)}},de=async()=>{try{await x.patch("http://65.1.233.188:9000/api/v1/admin/transaction/pay-credit",{transId:E,amount:p,summery:S,Toatalmount:L},{headers:{authKey:`${m()}`}});const t=await x.get("http://65.1.233.188:9000/api/v1/admin/transaction/get-all-credit",{headers:{authKey:`${m()}`}});$(t.data.data),y(!1),f(null),D([]),v(""),b("")}catch(t){console.error("Error paying credit:",t)}},K=be({inputData:J,filterName:T}),oe=!K.length&&!!T;return e.jsxs(he,{children:[e.jsxs(A,{direction:"row",alignItems:"center",justifyContent:"space-between",mt:5,mb:5,children:[e.jsx(W,{variant:"h4",children:"Customer Credits"}),e.jsx(d,{variant:"contained",color:"inherit",startIcon:e.jsx(me,{icon:"eva:plus-fill"}),onClick:()=>j(!0),children:"Add New Credit"})]}),e.jsxs(xe,{children:[e.jsx(A,{direction:"row",alignItems:"center",justifyContent:"space-between",p:2,children:e.jsx(o,{variant:"outlined",value:T,onChange:le,placeholder:"Search by summary"})}),e.jsx(ge,{children:e.jsx(je,{sx:{overflow:"unset",p:2},children:e.jsxs(pe,{sx:{minWidth:800},children:[e.jsx(Ce,{children:e.jsxs(k,{children:[e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Phone"}),e.jsx(s,{children:e.jsx(I,{active:l==="productCount",direction:l==="productCount"?i:"asc",onClick:()=>P("productCount"),children:"Product Count"})}),e.jsx(s,{children:e.jsx(I,{active:l==="dueAmount",direction:l==="dueAmount"?i:"asc",onClick:()=>P("dueAmount"),children:"Due Amount"})}),e.jsx(s,{children:e.jsx(I,{active:l==="totalAmount",direction:l==="totalAmount"?i:"asc",onClick:()=>P("totalAmount"),children:"Total Amount"})}),e.jsx(s,{children:"Summary"}),e.jsx(s,{children:e.jsx(I,{active:l==="createdAt",direction:l==="createdAt"?i:"asc",onClick:()=>P("createdAt"),children:"Date"})}),e.jsx(s,{children:" "})]})}),e.jsxs(ye,{children:[Q?e.jsx(k,{children:e.jsx(s,{colSpan:8,align:"center",children:"Loading..."})}):K.slice(u*C,u*C+C).map(t=>{var n,r,B,O;return e.jsxs(k,{children:[e.jsx(s,{children:`${(n=t==null?void 0:t.userId)==null?void 0:n.firstName} ${(r=t==null?void 0:t.userId)==null?void 0:r.surname}`}),e.jsx(s,{children:(B=t==null?void 0:t.userId)==null?void 0:B.phone}),e.jsx(s,{children:(O=t==null?void 0:t.productDetails)==null?void 0:O.length}),e.jsx(s,{children:t==null?void 0:t.dueAmount}),e.jsx(s,{children:t==null?void 0:t.Toatalmount}),e.jsx(s,{children:t==null?void 0:t.summery}),e.jsx(s,{children:new Date(t==null?void 0:t.updatedAt).toLocaleDateString()}),e.jsx(s,{children:e.jsx(fe,{checked:E===t._id,onChange:()=>ne()})})]},t._id)}),oe&&e.jsx(k,{children:e.jsx(s,{colSpan:8,align:"center",children:"No data found"})})]})]})})}),e.jsxs(A,{direction:"row",spacing:2,justifyContent:"left",p:2,mt:2,children:[e.jsx(d,{variant:"contained",color:"success",size:"large",onClick:()=>j(!0),children:"Credit"}),e.jsx(d,{variant:"contained",color:"error",size:"large",onClick:()=>y(!0),disabled:!E,children:"Pay"}),e.jsx(d,{variant:"contained",color:"inherit",size:"large",onClick:()=>window.history.back(),children:"Back"})]}),e.jsx(ve,{rowsPerPageOptions:[5,10,25],component:"div",count:K.length,rowsPerPage:C,page:u,onPageChange:re,onRowsPerPageChange:ce})]}),e.jsxs(U,{open:X,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(N,{children:"Add Credit"}),e.jsx(_,{children:e.jsxs(A,{spacing:3,children:[e.jsx(M,{options:Y,getOptionLabel:t=>`${t==null?void 0:t.firstName} ${t==null?void 0:t.surname}`,renderInput:t=>e.jsx(o,{...t,label:"Select User"}),onChange:(t,n)=>f(n)}),e.jsx(M,{multiple:!0,options:w,getOptionLabel:t=>t==null?void 0:t.product_Name,renderInput:t=>e.jsx(o,{...t,label:"Select Products"}),onChange:(t,n)=>D(n.map(r=>({productId:r==null?void 0:r._id,quantity:1})))}),e.jsx(o,{label:"Amount",value:p,onChange:t=>v(t.target.value),fullWidth:!0}),e.jsx(o,{label:"Comment",value:S,onChange:t=>b(t.target.value),fullWidth:!0}),e.jsx(d,{variant:"contained",onClick:ie,children:"Submit"})]})}),e.jsx(R,{children:e.jsx(d,{onClick:()=>j(!1),children:"Cancel"})})]}),e.jsxs(U,{open:V,onClose:()=>y(!1),children:[e.jsx(N,{children:"Make a Payment"}),e.jsxs(_,{children:[e.jsx(o,{label:"Amount",type:"number",value:p,onChange:t=>v(t.target.value),fullWidth:!0,margin:"normal"}),e.jsx(o,{label:"Total Amount",type:"number",value:L,onChange:t=>ae(t.target.value),fullWidth:!0,margin:"normal"}),e.jsx(o,{label:"Comment",value:S,onChange:t=>b(t.target.value),fullWidth:!0,margin:"normal"}),h&&e.jsxs(e.Fragment,{children:[e.jsxs(W,{variant:"subtitle1",children:["User: ",h.firstName," ",h.surname]}),e.jsxs(W,{variant:"subtitle1",children:["Phone: ",h.phone]})]})]}),e.jsxs(R,{children:[e.jsx(d,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:de,children:"Submit"})]})]})]})}function ke(){return e.jsxs(e.Fragment,{children:[e.jsx(Se,{children:e.jsx("title",{children:" Customer Credit "})}),e.jsx(Pe,{})]})}export{ke as default};
